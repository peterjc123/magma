<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>MAGMA: Installing MAGMA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="magma-logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAGMA
   &#160;<span id="projectnumber">2.5.3</span>
   </div>
   <div id="projectbrief">Matrix Algebra for GPU and Multicore Architectures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Routines</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('installing.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Installing MAGMA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>First, create a <code>make.inc</code> file, using one of the examples as a template.</p>
<p>Set environment variables for where external packages are installed, either in your <code>.cshrc/.bashrc</code> file, or in the <code>make.inc</code> file itself.</p>
<h4>CUDA</h4>
<p>All the <code>make.inc</code> files assume <code>$CUDADIR</code> is set in your environment. For bash (sh), put in <code>~/.bashrc</code> (with your system's path): </p>
<pre class="fragment">export CUDADIR=/usr/loca/cuda
</pre><p>For csh/tcsh, put in <code>~/.cshrc</code>: </p>
<pre class="fragment">setenv CUDADIR /usr/local/cuda
</pre><p>MAGMA is tested with CUDA &gt;= 7.5. Some functionality requires a newer version.</p>
<h4>Intel MKL</h4>
<p>The MKL <code>make.inc</code> files assume <code>$MKLROOT</code> is set in your environment. To set it, for bash (sh), put in ~/.bashrc (with your system's path): </p>
<pre class="fragment">source /opt/intel/bin/compilervars.sh intel64
</pre><p>For csh/tcsh, put in ~/.cshrc: </p>
<pre class="fragment">source /opt/intel/bin/compilervars.csh intel64
</pre><p>MAGMA is tested with MKL 11.3.3 (2016), both LP64 and ILP64; other versions may work.</p>
<h4>AMD ACML</h4>
<p>The ACML <code>make.inc</code> file assumes <code>$ACMLDIR</code> is set in your environment. For bash (sh), put in ~/.bashrc (with your system's path): </p>
<pre class="fragment">export ACMLDIR=/opt/acml-5.3.1
</pre><p>For csh/tcsh, put in ~/.cshrc: </p>
<pre class="fragment">setenv ACMLDIR  /opt/acml-5.3.1
</pre><p>MAGMA is tested with ACML 5.3.1; other versions may work. See comments in <code>make.inc.acml</code> regarding ACML 4; a couple testers fail to compile with ACML 4.</p>
<h4>ATLAS</h4>
<p>The ATLAS <code>make.inc</code> file assumes <code>$ATLASDIR</code> and <code>$LAPACKDIR</code> are set in your environment. If not installed, install LAPACK from <a href="http://www.netlib.org/lapack/">http://www.netlib.org/lapack/</a> For bash (sh), put in ~/.bashrc (with your system's path): </p>
<pre class="fragment">export ATLASDIR=/opt/atlas
export LAPACKDIR=/opt/LAPACK
</pre><p>For csh/tcsh, put in ~/.cshrc: </p>
<pre class="fragment">setenv ATLASDIR  /opt/atlas
setenv LAPACKDIR /opt/LAPACK
</pre><h4>OpenBLAS</h4>
<p>The OpenBLAS <code>make.inc</code> file assumes <code>$OPENBLASDIR</code> is set in your environment. For bash (sh), put in ~/.bashrc (with your system's path): </p>
<pre class="fragment">export OPENBLASDIR=/opt/openblas
</pre><p>For csh/tcsh, put in ~/.cshrc: </p>
<pre class="fragment">setenv OPENBLASDIR /opt/openblas
</pre><p>Some bugs exist with OpenBLAS 0.2.19; see BUGS.txt.</p>
<h4>MacOS Accelerate (previously Veclib)</h4>
<p>Unfortunately, the MacOS Accelerate framework uses an old ABI for BLAS and LAPACK, where single precision functions &ndash; such as <code>sdot</code>, <code>cdot</code>, <code>slange</code>, and <code>clange</code> &ndash; return a double precision result. This makes them incompatibile with our C/C++ headers and with the Fortran code used in our testers. The fix is to substitute reference implementations of these functions, found in <code>magma/blas_fix</code>. Setting <code>blas_fix = 1</code> in <code>make.inc</code> will compile these into <code>magma/lib/libblas_fix.a</code>, with which your application should link.</p>
<h2>Linking to BLAS </h2>
<p>Depending on the Fortran compiler used for your BLAS and LAPACK libraries, the linking convention is one of:</p>
<ul>
<li>Add underscore, so <code>gemm()</code> in Fortran becomes <code>gemm_()</code> in C.</li>
<li>Uppercase, so <code>gemm()</code> in Fortran becomes <code>GEMM()</code> in C.</li>
<li>No change, so <code>gemm()</code> in Fortran stays <code>gemm()</code> in C.</li>
</ul>
<p>Set <code>-DADD_</code>, <code>-DUPCASE</code>, or <code>-DNOCHANGE</code>, respectively, in all FLAGS in your <code>make.inc</code> file to select the appropriate one. Use <code>nm</code> to examine your BLAS library: </p>
<pre class="fragment">acml-5.3.1/gfortran64_mp/lib&gt; nm libacml_mp.a | grep -i 'T.*dgemm'
0000000000000000 T dgemm
00000000000004e0 T dgemm_
</pre><p>In this case, it shows that either <code>-DADD_ (dgemm_)</code> or <code>-DNOCHANGE (dgemm)</code> should work. The default in all make.inc files is <code>-DADD_</code>.</p>
<h2>Compile-time options </h2>
<p>Several compiler defines, below, affect how MAGMA is compiled and might have a large performance impact. These are set in <code>make.inc</code> files using the <code>-D</code> compiler flag, e.g., <code>-DMAGMA_WITH_MKL</code> in CFLAGS.</p>
<ul>
<li><p class="startli"><code>MAGMA_WITH_MKL</code></p>
<p class="startli">If linked with MKL, allows MAGMA to get MKL's version and set MKL's number of threads.</p>
</li>
<li><p class="startli"><code>MAGMA_WITH_ACML</code></p>
<p class="startli">If linked with ACML 5 or later, allows MAGMA to get ACML's version. ACML's number of threads are set via OpenMP.</p>
</li>
<li><p class="startli"><code>MAGMA_NO_V1</code></p>
<p class="startli">Disables MAGMA v1.x compatability. Skips compiling non-queue versions of MAGMA BLAS routines, and simplifies <a class="el" href="group__magma__init.html#ga7cc179c267eb6c5f154ffd40d4759ab3" title="Initializes the MAGMA library. ">magma_init()</a>.</p>
</li>
<li><p class="startli"><code>MAGMA_NOAFFINITY</code></p>
<p class="startli">Disables thread affinity, available in glibc 2.6 and later.</p>
</li>
<li><p class="startli"><code>BATCH_DISABLE_CHECKING</code></p>
<p class="startli">For batched routines, disables the info_array that contains errors. For example, for Cholesky factorization if you are sure your matrix is SPD and want better performance, you can compile with this flag.</p>
</li>
<li><p class="startli"><code>BATCH_DISABLE_CLEANUP</code></p>
<p class="startli">For batched routines, disables the cleanup code. For example, the {sy|he}rk called with "lower" will write data on the upper triangular portion of the matrix.</p>
</li>
<li><p class="startli"><code>BATCHED_DISABLE_PARCPU</code></p>
<p class="startli">In the testing directory, disables the parallel implementation of the batched computation on CPU. Can be used to compare a naive versus a parallelized CPU batched computation.</p>
</li>
</ul>
<h2>Run-time options </h2>
<p>These variables control MAGMA, BLAS, and LAPACK run-time behavior.</p>
<ul>
<li><code>$MAGMA_NUM_GPUS</code></li>
</ul>
<p>For multi-GPU functions, set <code>$MAGMA_NUM_GPUS</code> to the number of GPUs to use.</p>
<ul>
<li><code>$OMP_NUM_THREADS</code></li>
<li><code>$MKL_NUM_THREADS</code></li>
<li><p class="startli"><code>$VECLIB_MAXIMUM_THREADS</code></p>
<p class="startli">For multi-core BLAS libraries, set <code>$OMP_NUM_THREADS</code> or <code>$MKL_NUM_THREADS</code> or <code>$VECLIB_MAXIMUM_THREADS</code> to the number of CPU threads, depending on your BLAS library. See the documentation for your BLAS and LAPACK libraries.</p>
</li>
</ul>
<h2>Building without Fortran </h2>
<p>If you do not have a Fortran compiler, comment out <code>FORT</code> in <code>make.inc</code>. MAGMA's Fortran 90 interface and Fortran testers will not be built. Also, many testers will not be able to check their results &ndash; they will print an error message, e.g.: </p>
<pre class="fragment">magma/testing&gt; ./testing_dgehrd -N 100 -c
...
Cannot check results: dhst01_ unavailable, since there was no Fortran compiler.
  100     ---   (  ---  )      0.70 (   0.00)   0.00e+00        0.00e+00   ok
</pre><h2>Building shared libraries </h2>
<p>By default, all <code>make.inc</code> files (except ATLAS) add the <code>-fPIC</code> option to CFLAGS, FFLAGS, F90FLAGS, and NVCCFLAGS, required for building a shared library. Note in NVCCFLAGS that <code>-fPIC</code> is passed via the <code>-Xcompiler</code> option. Running: </p>
<pre class="fragment">make
</pre><p>or </p>
<pre class="fragment">make lib
make test
make sparse-lib
make sparse-test
</pre><p>will create shared libraries: </p>
<pre class="fragment">lib/libmagma.so
lib/libmagma_sparse.so
</pre><p>and static libraries: </p>
<pre class="fragment">lib/libmagma.a
lib/libmagma_sparse.a
</pre><p>and testing drivers in <code>testing</code> and <code>sparse-iter/testing</code>.</p>
<p>The current exception is for ATLAS, in <code>make.inc.atlas</code>, which in our install is a static library, thus requiring MAGMA to be a static library.</p>
<h2>Building static libraries </h2>
<p>Static libraries are always built along with the shared libraries above. Alternatively, comment out <code>FPIC</code> in your <code>make.inc</code> file to compile only a static library. Then, running: </p>
<pre class="fragment">make
</pre><p>will create static libraries: </p>
<pre class="fragment">lib/libmagma.a
lib/libmagma_sparse.a
</pre><p>and testing drivers in <code>testing</code> and <code>sparse-iter/testing</code>.</p>
<h2>Installation </h2>
<p>To install libraries and include files in a given prefix, run: </p>
<pre class="fragment">make install prefix=/usr/local/magma
</pre><p>The default prefix is <code>/usr/local/magma</code>. You can also set <code>prefix</code> in <code>make.inc</code>. This installs MAGMA libraries in <code>${prefix}/lib</code>, MAGMA header files in <code>${prefix}/include</code>, and <code>${prefix}/lib/pkgconfig/magma.pc</code> for <code>pkg-config</code>.</p>
<h2>Tuning </h2>
<p>You can modify the blocking factors for the algorithms of interest in <code>control/get_nb.cpp</code>.</p>
<p>Performance results are included in <code>results/vA.B.C/cudaX.Y-zzz/*.txt</code> for MAGMA version A.B.C, CUDA version X.Y, and GPU zzz. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
